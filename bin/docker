#!/usr/bin/env -S bash -e

image_id=$(docker build . --quiet)

mkdir -p build/volumes/elm-home build/volumes/firebase-config

docker_args=()
for arg in "${@}"; do
  shift
  if [ "$arg" = "--" ]; then
    break
  else
    docker_args=("${docker_args[@]}" "$arg")
  fi
done

docker run \
    --interactive \
    --tty \
    --rm \
    --mount type=bind,source="$(pwd)",target=/workdir \
    --mount type=bind,source="$(pwd)"/build/volumes/elm-home,target=/home/.elm \
    --mount type=bind,source="$(pwd)"/build/volumes/firebase-config,target=/home/.config \
    "${docker_args[@]}" "$image_id" "$@"
